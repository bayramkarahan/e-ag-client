#!/bin/bash
# input-on-pointer.sh â€” Fiziksel fare/iÅŸaretÃ§ileri otomatik olarak etkinleÅŸtirir (X11 iÃ§in)

set -e

# Aktif X oturumu olan kullanÄ±cÄ±yÄ± bul
USER=$(who | grep -E "\(:(0|1|2)" | awk '{print $1}' | head -n 1)
DISPLAY=$(who | grep -E "\(:(0|1|2)" | sed -E "s/.*\((:[0-9.]+)\).*/\1/" | head -n 1)

# Yedekleme (fallback)
USER=${USER:-$(logname)}
DISPLAY=${DISPLAY:-":0"}

XAUTHORITY="/home/$USER/.Xauthority"

if [ -z "$USER" ] || [ ! -f "$XAUTHORITY" ]; then
    echo "âŒ X oturumu bulunamadÄ± veya XAUTHORITY dosyasÄ± yok."
    echo "â„¹ï¸ USER=$USER, DISPLAY=$DISPLAY, XAUTHORITY=$XAUTHORITY"
    exit 1
fi

echo "ğŸ§© KullanÄ±cÄ±: $USER"
echo "ğŸ–¥ï¸ DISPLAY: $DISPLAY"
echo "ğŸ“ XAUTHORITY: $XAUTHORITY"
echo "ğŸ”“ Fiziksel FARE / POINTER cihazlarÄ± yeniden etkinleÅŸtiriliyor..."
echo ""

sudo -u "$USER" env DISPLAY=$DISPLAY XAUTHORITY=$XAUTHORITY bash -s <<'EOF'
PATTERNS=("mouse" "optical" "logitech" "synaptics" "imexps/2")

echo "ğŸ” xinput listesi (pointer aygÄ±tlarÄ±):"
xinput list | grep -i "pointer" || echo "âš ï¸ Pointer aygÄ±tÄ± bulunamadÄ±"
echo ""

for pattern in "${PATTERNS[@]}"; do
    ids=$(xinput list | grep -iF "$pattern" | sed -E "s/.*id=([0-9]+).*/\1/" || true)
    if [ -n "$ids" ]; then
        for id in $ids; do
            if xinput enable "$id" 2>/dev/null; then
                echo "âœ… $pattern (ID: $id) etkinleÅŸtirildi"
            else
                echo "âš ï¸ $pattern (ID: $id) etkinleÅŸtirilemedi"
            fi
        done
    else
        echo "âš ï¸ '$pattern' iÃ§in eÅŸleÅŸme bulunamadÄ±"
    fi
done
EOF

