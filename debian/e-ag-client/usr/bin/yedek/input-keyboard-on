#!/bin/bash
# ğŸ”“ Klavyeyi yeniden etkinleÅŸtir â€” kesin Ã§Ã¶zÃ¼m

USER=$(who | grep "(:0" | awk '{print $1}' | head -n 1)
DISPLAY=":0"
XAUTHORITY="/home/$USER/.Xauthority"

if [ -z "$USER" ] || [ ! -f "$XAUTHORITY" ]; then
    echo "âŒ X oturumu bulunamadÄ±"
    exit 1
fi

sudo -u "$USER" DISPLAY=$DISPLAY XAUTHORITY=$XAUTHORITY bash -c '
MASTER_ID=$(xinput list | grep -m1 "Virtual core keyboard" | grep -o "id=[0-9]*" | cut -d= -f2)

xinput list | grep -Ei "keyboard|Translated|HID" | grep -viE "Virtual|XTEST|Button" | while read -r line; do
    id=$(echo "$line" | grep -o "id=[0-9]*" | cut -d= -f2)
    name=$(echo "$line" | sed -E "s/.*â†³ (.*)id=.*/\1/" | xargs)
    if [ -n "$id" ]; then
        xinput enable "$id" 2>/dev/null
        xinput reattach "$id" "$MASTER_ID" 2>/dev/null
        echo "ğŸ”“ $name (id=$id) yeniden etkinleÅŸtirildi"
    fi
done
'
