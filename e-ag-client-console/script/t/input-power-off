#!/bin/bash
# input-off-power.sh â€” Power Button cihazÄ±nÄ± devre dÄ±ÅŸÄ± bÄ±rakÄ±r (X11 iÃ§in)

# ğŸ” Aktif kullanÄ±cÄ± ve DISPLAY tespiti
USER=$(who | grep -Eo "^[^ ]+" | head -n 1)
DISPLAY=$(who | grep -Eo "\(.*\)" | head -n 1 | tr -d '()')
XAUTHORITY="/home/$USER/.Xauthority"

# ğŸ§© Kontroller
if [ -z "$USER" ] || [ ! -f "$XAUTHORITY" ]; then
    echo "âŒ X oturumu veya XAUTHORITY dosyasÄ± bulunamadÄ±."
    exit 1
fi

echo "ğŸ§© KullanÄ±cÄ±: $USER"
echo "ğŸ–¥ï¸ DISPLAY: $DISPLAY"
echo "ğŸ“ XAUTHORITY: $XAUTHORITY"
echo "ğŸ”’ Power Button devre dÄ±ÅŸÄ± bÄ±rakÄ±lÄ±yor..."

# ğŸ‘‡ X oturumunda komutlarÄ± Ã§alÄ±ÅŸtÄ±r
sudo -u "$USER" DISPLAY=$DISPLAY XAUTHORITY=$XAUTHORITY bash -c '
for id in $(xinput list |
    grep -E "Power Button" |
    grep -v -E "Virtual|XTEST|Integration|Dummy" |
    sed -E "s/.*id=([0-9]+).*/\1/"); do

    name=$(xinput list --name-only "$id" 2>/dev/null)
    if xinput --list-props "$id" &>/dev/null; then
        xinput disable "$id" && echo "â›” $name (ID: $id) devre dÄ±ÅŸÄ± bÄ±rakÄ±ldÄ±"
    else
        echo "âš ï¸ $name (ID: $id) Ã¼zerinde iÅŸlem yapÄ±lamÄ±yor"
    fi
done
'

