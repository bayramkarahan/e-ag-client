#!/bin/bash

if readlink /usr/sbin/iptables | grep -q "nft"; then
    update-alternatives --set iptables /usr/sbin/iptables-legacy
    update-alternatives --set ip6tables /usr/sbin/ip6tables-legacy
fi

LOCK_FILE="/tmp/yt-block.lock"

if pgrep -f "youtube-off-loop" >/dev/null; then
    echo "âš ï¸ YouTube engelleme zaten aktif."
    exit 0
fi

touch "$LOCK_FILE"

echo "ğŸš« YouTube engelleme dÃ¶ngÃ¼sÃ¼ baÅŸlatÄ±ldÄ±..."

# DÃ¶ngÃ¼yÃ¼ isimli bir sÃ¼reÃ§ olarak baÅŸlat
bash -c '
process_name="youtube-off-loop"
while [ -f "/tmp/yt-block.lock" ]; do
    /usr/bin/youtube-block
    sleep 90
done
echo "âœ… Engelleme dÃ¶ngÃ¼sÃ¼ sonlandÄ±rÄ±ldÄ±."
' & disown

